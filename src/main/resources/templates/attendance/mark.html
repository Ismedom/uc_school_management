<!doctype html>
<html
    xmlns:th="http://www.thymeleaf.org"
    th:replace="~{layout/main :: layout(~{::div#content}, ~{::title})}"
>
    <head>
        <title>Mark Attendance - School Management System</title>
    </head>

    <body>
        <div id="content">
            <div class="mb-8 flex items-center justify-between">
                <div>
                    <a
                        th:href="@{/attendance}"
                        class="text-blue-600 hover:text-blue-800 text-sm font-medium inline-flex items-center mb-2"
                    >
                        <i class="fas fa-arrow-left mr-2"></i>Back to Selector
                    </a>
                    <h1 class="text-2xl font-bold text-gray-900">Mark Attendance</h1>
                    <p class="text-gray-500 text-sm mt-1">
                        Section:
                        <span
                            class="font-semibold text-gray-700"
                            th:text="|${section.schoolClass.name} - ${section.name}|"
                            >Grade 10 - A</span
                        >
                        | Date:
                        <span
                            class="font-semibold text-gray-700"
                            th:text="${#temporals.format(date, 'MMMM dd, yyyy')}"
                            >January 22, 2024</span
                        >
                    </p>
                </div>
                <div class="flex gap-3">
                    <button
                        type="button"
                        onclick="markAll('PRESENT')"
                        class="px-3 py-1.5 text-xs font-semibold bg-green-50 text-green-700 border border-green-200 rounded-lg hover:bg-green-100 transition-colors"
                    >
                        Mark All Present
                    </button>
                </div>
            </div>

            <form th:action="@{/attendance/mark}" th:object="${bulkRequest}" method="POST">
                <input type="hidden" th:field="*{sectionId}" />
                <input type="hidden" th:field="*{date}" />

                <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                    <table class="w-full text-left">
                        <thead class="bg-gray-50 border-b border-gray-100">
                            <tr>
                                <th
                                    class="px-6 py-4 text-xs font-semibold text-gray-500 uppercase tracking-wider w-12"
                                >
                                    No.
                                </th>
                                <th
                                    class="px-6 py-4 text-xs font-semibold text-gray-500 uppercase tracking-wider"
                                >
                                    Student Name
                                </th>
                                <th
                                    class="px-6 py-4 text-xs font-semibold text-gray-500 uppercase tracking-wider text-center"
                                >
                                    Status
                                </th>
                                <th
                                    class="px-6 py-4 text-xs font-semibold text-gray-500 uppercase tracking-wider"
                                >
                                    Remarks
                                </th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-100">
                            <tr
                                th:each="record, stat : ${records}"
                                class="hover:bg-gray-50/50 transition-colors"
                            >
                                <td class="px-6 py-4 text-sm text-gray-500" th:text="${stat.count}">
                                    1
                                </td>
                                <td class="px-6 py-4">
                                    <span
                                        class="font-medium text-gray-900"
                                        th:text="${record.studentName}"
                                        >John Doe</span
                                    >
                                    <input
                                        type="hidden"
                                        th:name="|records[${stat.index}].studentId|"
                                        th:value="${record.studentId}"
                                    />
                                </td>
                                <td class="px-6 py-4">
                                    <div class="flex justify-center space-x-6">
                                        <label
                                            class="flex items-center space-x-2 cursor-pointer group"
                                        >
                                            <input
                                                type="radio"
                                                th:name="|records[${stat.index}].status|"
                                                value="PRESENT"
                                                th:checked="${record.status == null || record.status.name() == 'PRESENT'}"
                                                class="status-radio w-4 h-4 text-green-600 border-gray-300 focus:ring-green-500"
                                            />
                                            <span
                                                class="text-sm font-medium text-gray-600 group-hover:text-green-600 transition-colors"
                                                >P</span
                                            >
                                        </label>
                                        <label
                                            class="flex items-center space-x-2 cursor-pointer group"
                                        >
                                            <input
                                                type="radio"
                                                th:name="|records[${stat.index}].status|"
                                                value="ABSENT"
                                                th:checked="${record.status != null && record.status.name() == 'ABSENT'}"
                                                class="status-radio w-4 h-4 text-red-600 border-gray-300 focus:ring-red-500"
                                            />
                                            <span
                                                class="text-sm font-medium text-gray-600 group-hover:text-red-600 transition-colors"
                                                >A</span
                                            >
                                        </label>
                                        <label
                                            class="flex items-center space-x-2 cursor-pointer group"
                                        >
                                            <input
                                                type="radio"
                                                th:name="|records[${stat.index}].status|"
                                                value="LATE"
                                                th:checked="${record.status != null && record.status.name() == 'LATE'}"
                                                class="status-radio w-4 h-4 text-orange-600 border-gray-300 focus:ring-orange-500"
                                            />
                                            <span
                                                class="text-sm font-medium text-gray-600 group-hover:text-orange-600 transition-colors"
                                                >L</span
                                            >
                                        </label>
                                        <label
                                            class="flex items-center space-x-2 cursor-pointer group"
                                        >
                                            <input
                                                type="radio"
                                                th:name="|records[${stat.index}].status|"
                                                value="EXCUSED"
                                                th:checked="${record.status != null && record.status.name() == 'EXCUSED'}"
                                                class="status-radio w-4 h-4 text-blue-600 border-gray-300 focus:ring-blue-500"
                                            />
                                            <span
                                                class="text-sm font-medium text-gray-600 group-hover:text-blue-600 transition-colors"
                                                >E</span
                                            >
                                        </label>
                                    </div>
                                </td>
                                <td class="px-6 py-4">
                                    <input
                                        type="text"
                                        th:name="|records[${stat.index}].remarks|"
                                        th:value="${record.remarks}"
                                        class="w-full px-3 py-1.5 border border-gray-200 rounded text-sm focus:ring-1 focus:ring-blue-500 focus:border-transparent outline-none"
                                        placeholder="Optional remarks..."
                                    />
                                </td>
                            </tr>
                            <tr th:if="${#lists.isEmpty(records)}">
                                <td colspan="4" class="px-6 py-12 text-center text-gray-500">
                                    <div class="flex flex-col items-center">
                                        <i
                                            class="fas fa-user-slash text-4xl mb-4 text-gray-200"
                                        ></i>
                                        <p>No students found in this section.</p>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="mt-8 flex justify-end">
                    <button
                        type="submit"
                        class="bg-blue-600 text-white px-8 py-3 rounded-lg font-bold hover:bg-blue-700 transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 active:translate-y-0 inline-flex items-center"
                    >
                        <i class="fas fa-save mr-2"></i>Save Attendance
                    </button>
                </div>
            </form>
        </div>

        <script th:inline="javascript">
            function markAll(status) {
                const radios = document.querySelectorAll('.status-radio');
                radios.forEach(radio => {
                    if (radio.value === status) {
                        radio.checked = true;
                    }
                });
            }
        </script>
    </body>
</html>
